name: CI

on: [push]

jobs:
  default-build:
    #runs-on: ubuntu-latest
    runs-on: ubuntu-16.04

    steps:
      - name: checkout
        uses: actions/checkout@v1

      #- name: Setup .NET Core
      #  uses: actions/setup-dotnet@v1
      #  with:
      #    dotnet-version: 2.2.108

      #- name: Build with dotnet
      #  run: dotnet build --configuration Release

      - name: build
        run:  dotnet build

      - name: package
        run:  dotnet pack

      - name: install nuget
        ## Win only:
        #uses: warrenbuckley/Setup-Nuget@v1
        uses: olegtarasov/download-nuget@v1

      - name: register nuget repo
        ## As per:
        ##  https://help.github.com/en/articles/configuring-nuget-for-use-with-github-package-registry
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        #run:  nuget sources Add -Name "GPR" \
        run: |
          mono $NUGET_EXE sources Add -Name "GPR" \
            -Source "https://nuget.pkg.github.com/ebekker/index.json" \
            -UserName ebekker -Password $GITHUB_TOKEN
          find . -name *.nupkg
          mono $NUGET_EXE setapikey $GITHUB_TOKEN -Source "GPR"

      - name: publish
        #run:  dotnet nuget push Bkkr.GitHub.TestActionsAndRegistry.nupkg --source GPR 
        run:  mono $NUGET_EXE push src/Bkkr.GitHub.TestActionsAndRegistry/bin/Debug/Bkkr.GitHub.TestActionsAndRegistry.nupkg -Source GPR 
