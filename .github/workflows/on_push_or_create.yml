
on: [push, create]

jobs:
  default-build:
    runs-on: ubuntu-16.04

    steps:
      - name: checkout
        uses: actions/checkout@v1

      - name: dump env
        run: |
          echo "GITHUB_SHA        = $GITHUB_SHA"
          echo "GITHUB_REF        = $GITHUB_REF"
          echo "GITHUB_WORKFLOW   = $GITHUB_WORKFLOW"
          echo "GITHUB_ACTION     = $GITHUB_ACTION"
          echo "GITHUB_ACTOR      = $GITHUB_ACTOR"
          echo "GITHUB_EVENT_NAME = $GITHUB_EVENT_NAME"
          echo "GITHUB_EVENT_PATH = $GITHUB_EVENT_PATH"
          echo "GITHUB_WORKSPACE  = $GITHUB_WORKSPACE"

      - name: dump event payload
        run: cat $GITHUB_EVENT_PATH

      - name: compute build numbers (pwsh)
        env:
          #BUILD_NUM_OAUTH: ${{ secrets.BUILD_NUM_OAUTH }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}      
        run: |
          pwsh -f ./.github/workflows/build-num.ps1  \
            -InformationAction Continue              \
            -GitHubToken ${{ secrets.BUILD_NUM_OAUTH }} \
            -VersionKey 0.0.0 
          echo "Dumping build numbers within step:"
          echo "GITHUB_WORKFLOW = $GITHUB_WORKFLOW"
          echo "THIS_BUILD_NUM = $THIS_BUILD_NUM"
          echo "VERS_BUILD_NUM = $VERS_BUILD_NUM"

      - name: dump build numbers
        run: |
          echo "THIS_BUILD_NUM = $THIS_BUILD_NUM"
          echo "VERS_BUILD_NUM = $VERS_BUILD_NUM"
      
      - name: testing command strings
        id: cmdStrings
        shell: pwsh
        run: |
          Write-Host   "::warning::This is a warning with Write-Host"
          Write-Output "::warning::This is a warning with Write-Output"
          Write-Host   "::set-env name=out1::This is the value of out1"
          Write-Host   "::set-output name=out2::This is the value of out2"
          Write-Output "::set-env name=OUT3::This is the value of OUT3"
          Write-Output "::set-output name=OUT4::This is the value of OUT4"
          Get-ChildItem env:
      
      - name: dumping step cmdStrings
        shell: pwsh
        run: |
          echo @"
            all steps:
            ${{ toJson(steps) }}
            cmdStrings:
            ${{ toJson(steps.cmdStrings)}}
          "@

      - name: dump env
        run: set

      - name: export vars
        id: exportVars
        shell: bash
        run: |
          export SAMPLE_VAR1=foo
          export SAMPLE_VAR2=bar
          export OUTPUT_SAMPLE_VAR1=foo
          export OUTPUT_SAMPLE_VAR2=bar
          echo "Exported vars:"
          echo "SAMPLE_VAR1 = $SAMPLE_VAR1"
          echo "SAMPLE_VAR2 = $SAMPLE_VAR2"

      - name: dump exported vars
        env:
          STEPS_JSON: ${{ toJson(steps) }}
        shell: bash
        run: |
          echo "Still Exported vars:"
          echo "SAMPLE_VAR1 = $SAMPLE_VAR1"
          echo "SAMPLE_VAR2 = $SAMPLE_VAR2"
          echo "Steps Context = $STEPS_JSON"
